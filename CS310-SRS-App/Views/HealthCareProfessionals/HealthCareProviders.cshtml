@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Staff Search";
}

<h3>Search For Staff: </h3>
<div class="search-container position-relative">
    <input type="text" id="patientSearch" class="form-control" placeholder="Search staff..." autocomplete="off">
    <ul id="searchResults" class="list-group position-absolute w-100" style="display:none;"></ul>
</div>
<br />

<form id="patientDetails" asp-action="SavePatientChart" method="post" style="display:none;">
    <h3>Staff info:</h3>
    <br>
    <p> name: teststaff1 teststaff1      <br />     email: teststaff1@gmail.com</p>

</form>

<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="//code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
    $(document).ready(function () {
        $('#patientSearch').keyup(function () {
            var searchTerm = $(this).val();
            if (searchTerm.length > 0) { // Trigger search for 3 or more characters
                $.ajax({
                    url: '@Url.Action("SearchPatients", "HealthCareProfessionals")',
                    type: 'GET',
                    data: { term: searchTerm },
                    success: function (data) {
                        var $searchResults = $('#searchResults');
                        $searchResults.empty(); // Clear previous results

                        if (data && data.length > 0) {
                            $.each(data, function (i, fullName) { // Assuming `data` is an array of strings (patient full names)
                                var listItem = $('<li>')
                                    .addClass('list-group-item list-group-item-action')
                                    .text(fullName) // Directly use the fullName string
                                    .click(function () {
                                        $('#patientSearch').val(fullName); // Update textbox with selected patient name
                                        $('#selectedPatientName').val(fullName); // Update hidden field with selected patient name
                                        $searchResults.hide();
                                        return false; // Prevent the default action
                                    });
                                $searchResults.append(listItem);
                            });

                            $searchResults.show(); // Show results
                        } else {
                            $searchResults.hide(); // Hide results if none
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Error: " + status + " " + error);
                    }
                });
            } else {
                $('#searchResults').empty().hide(); // Hide dropdown if searchTerm is less than 3 characters
            }
        });

        // Hide the searchResults list when clicking outside
        $(document).click(function (event) {
            if (!$(event.target).closest('#patientSearch, #searchResults').length) {
                $('#searchResults').hide();
            }
        });
    });
</script>
<script>
    $(document).ready(function () {
        // Listen for changes on the #patientSearch input
        $('#patientSearch').change(function () {
            // Check if the input has a value
            if ($(this).val() !== '') {
                // If there is a value, show the patient details form
                $('#patientDetails').slideDown(); // Use slideDown for a smooth transition
            } else {
                // If the input is empty, hide the patient details form
                $('#patientDetails').slideUp(); // Use slideUp to hide with a smooth transition
            }
        });

        // Update hidden field with patient name when search input changes
        $('#patientSearch').on('input', function () {
            var patientName = $(this).val();
            $('#selectedPatientName').val(patientName);
        });

        // Handle click on search results
        $('#searchResults').on('click', 'li', function () {
            var selectedPatientName = $(this).text();
            $('#patientSearch').val(selectedPatientName); // Update search box with selected patient name
            $('#selectedPatientName').val(selectedPatientName); // Update hidden field with selected patient name
            $('#searchResults').hide(); // Hide search results
            $('#patientDetails').slideDown(); // Show patient details form
        });
    });
</script>





<style>
    .search-container {
        /* Container to control the position of the dropdown */
        width: 250%; /* Adjust as needed */
        max-width: 400px; /* Adjust as needed */
    }

    #searchResults {
        z-index: 1051; /* Ensure it's above other content */
        max-height: 300px; /* Limit height and make scrollable */
        overflow-y: auto;
    }
</style>
